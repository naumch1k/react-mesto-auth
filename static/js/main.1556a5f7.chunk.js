(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(18),s=n.n(c),i=n(8),r=(n(29),n(22)),l=n(2),u=n(3),m=n.p+"static/media/header-logo.5f3664ca.svg",d=n(0);var j=function(e){var t=e.loggedIn,n=e.userEmail,a=e.onSignOut,o=Object(u.h)();return Object(d.jsxs)("header",{className:"header page__header",children:[Object(d.jsx)("img",{className:"header__logo",src:m,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u0441\u0435\u0440\u0432\u0438\u0441\u0430 Mesto Russia"}),!t&&Object(d.jsxs)("nav",{children:["/sign-in"===o.pathname&&Object(d.jsx)(i.b,{className:"header__navlink",to:"/sign-up",children:"Sign up"}),"/sign-up"===o.pathname&&Object(d.jsx)(i.b,{className:"header__navlink",to:"/sign-in",children:"Sign in"})]}),t&&Object(d.jsxs)("div",{className:"header__user-info",children:[Object(d.jsx)("p",{className:"header__email",children:n}),Object(d.jsx)("button",{onClick:a,className:"header__button",type:"button",children:"Sign out"})]})]})},b=o.a.createContext();var p=function(e){var t=e.card,n=e.onClick,o=e.onCardLike,c=e.onCardDelete,s=Object(a.useContext)(b),i=t.owner._id===s._id,r=t.likes.some((function(e){return e._id===s._id})),l="element__delete-btn ".concat(i?"":"element__delete-btn_hidden"),u="element__like-btn ".concat(r?"element__like-btn_active":"");return Object(d.jsxs)("li",{className:"element",children:[Object(d.jsx)("img",{onClick:function(){n(t)},className:"element__image",src:t.link,alt:"".concat(t.name)}),Object(d.jsxs)("div",{className:"element__desc",children:[Object(d.jsx)("h3",{className:"element__title",children:t.name}),Object(d.jsxs)("div",{className:"element__like-container",children:[Object(d.jsx)("button",{onClick:function(){o(t)},className:u,type:"button","aria-label":"Like photo"}),Object(d.jsx)("span",{className:"element__like-count",children:t.likes.length})]})]}),Object(d.jsx)("button",{onClick:function(){c(t)},className:l,type:"button","aria-label":"Delete photo"})]})};var _=function(){return Object(d.jsx)("div",{className:"loader"})};var h=function(e){var t=Object(a.useContext)(b);return Object(d.jsxs)("main",{className:"content page__content",children:[Object(d.jsxs)("section",{className:"profile content__section",children:[Object(d.jsxs)("div",{className:"profile__avatar-container",children:[Object(d.jsx)("img",{className:"profile__avatar",src:t.avatar,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f \u043f\u0440\u043e\u0444\u0438\u043b\u044f"}),Object(d.jsx)("button",{className:"profile__avatar-btn","aria-label":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",onClick:e.onEditAvatar})]}),Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsx)("h1",{className:"profile__name",children:t.name}),Object(d.jsx)("p",{className:"profile__bio",children:t.about}),Object(d.jsx)("button",{className:"profile__edit-btn",type:"button","aria-label":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onClick:e.onEditProfile})]}),Object(d.jsx)("button",{className:"profile__add-btn",type:"button","aria-label":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e",onClick:e.onAddPlace})]}),Object(d.jsx)("section",{className:"elements content__section",children:e.isLoading?Object(d.jsx)(_,{}):Object(d.jsx)("ul",{className:"elements__list",children:e.cards.map((function(t){return Object(d.jsx)(p,{card:t,onClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}))})})]})};var f=function(e){var t=e.onLogin,n=Object(a.useState)(""),o=Object(l.a)(n,2),c=o[0],s=o[1],i=Object(a.useState)(""),r=Object(l.a)(i,2),u=r[0],m=r[1];return Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t({password:u,email:c})},className:"form form_theme_dark",name:"login-form",children:[Object(d.jsx)("h2",{className:"form__heading form__heading_theme_dark",children:"Sign in to Mesto"}),Object(d.jsxs)("fieldset",{className:"form__items form__items_theme_dark",children:[Object(d.jsx)("input",{className:"form__item form__item_theme_dark form__item_el_email",id:"email",type:"email",name:"email",placeholder:"Email",value:c,onChange:function(e){s(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"email-error"}),Object(d.jsx)("input",{className:"form__item form__item_theme_dark form__item_el_password",id:"password",type:"password",name:"password",placeholder:"Password",value:u,onChange:function(e){m(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"password-error"})]}),Object(d.jsx)("button",{className:"form__submit-btn form__submit-btn_theme_dark",type:"submit",children:"Sign in"})]})};var O=function(e){var t=e.onRegistration,n=Object(a.useState)(""),o=Object(l.a)(n,2),c=o[0],s=o[1],r=Object(a.useState)(""),u=Object(l.a)(r,2),m=u[0],j=u[1];return Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t({password:m,email:c})},className:"form form_theme_dark",name:"signup-form",children:[Object(d.jsx)("h2",{className:"form__heading form__heading_theme_dark",children:"Create an account"}),Object(d.jsxs)("fieldset",{className:"form__items form__items_theme_dark",children:[Object(d.jsx)("input",{className:"form__item form__item_theme_dark form__item_el_email",id:"email",type:"email",name:"email",placeholder:"Email",value:c,onChange:function(e){s(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"email-error"}),Object(d.jsx)("input",{className:"form__item form__item_theme_dark form__item_el_password",id:"password",type:"password",name:"password",placeholder:"Password",value:m,onChange:function(e){j(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"password-error"})]}),Object(d.jsx)("button",{className:"form__submit-btn form__submit-btn_theme_dark",type:"submit",children:"Sign up"}),Object(d.jsxs)("p",{className:"form__text",children:["Already have an account?",Object(d.jsx)(i.b,{to:"/sign-in",className:"form__link",children:" Sign in"})]})]})};var g=function(){return Object(d.jsx)("footer",{className:"footer page__footer",children:Object(d.jsxs)("p",{className:"footer__copyright",children:["\xa9 ",(new Date).getFullYear()," Mesto Russia"]})})};var x=function(e){return Object(d.jsx)("div",{className:"popup popup_type_".concat(e.name,"  ").concat(e.isOpen&&"popup_opened"),children:Object(d.jsxs)("div",{className:"popup__container popup__container_type_form",children:[Object(d.jsx)("button",{onClick:e.onClose,className:"popup__close-btn",type:"button","aria-label":"Close popup"}),Object(d.jsxs)("form",{onSubmit:e.onSubmit,className:"form",name:"".concat(e.name,"-form"),children:[Object(d.jsx)("h2",{className:"form__heading",children:e.title}),Object(d.jsx)("fieldset",{className:"form__items",children:e.children}),Object(d.jsx)("button",{className:"form__submit-btn",type:"submit",children:e.buttonText})]})]})})};var v=function(e){var t=Object(a.useContext)(b),n=Object(a.useState)(""),o=Object(l.a)(n,2),c=o[0],s=o[1],i=Object(a.useState)(""),r=Object(l.a)(i,2),u=r[0],m=r[1];return Object(a.useEffect)((function(){s(t.name),m(t.about)}),[t,e.isOpen]),Object(d.jsxs)(x,{name:"edit",title:"Edit profile",buttonText:e.buttonText,isOpen:e.isOpen,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:u})},onClose:e.onClose,children:[Object(d.jsx)("input",{className:"form__item form__item_el_name",id:"profile-name",type:"text",name:"name",placeholder:"Name",minLength:"2",maxLength:"40",value:c,onChange:function(e){s(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"profile-name-error"}),Object(d.jsx)("input",{className:"form__item form__item_el_bio",id:"profile-bio",type:"text",name:"about",placeholder:"About",minLength:"2",maxLength:"200",value:u,onChange:function(e){m(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"profile-bio-error"})]})};var N=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current.value=""}),[e.isOpen]),Object(d.jsxs)(x,{name:"avatar",title:"Update Profile Picture",buttonText:e.buttonText,isOpen:e.isOpen,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},onClose:e.onClose,children:[Object(d.jsx)("input",{className:"form__item",id:"avatar-url",type:"url",name:"avatar",ref:t,placeholder:"Link",required:!0}),Object(d.jsx)("p",{className:"form__error",id:"avatar-url-error"})]})};var k=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),o=n[0],c=n[1],s=Object(a.useState)(""),i=Object(l.a)(s,2),r=i[0],u=i[1];return Object(a.useEffect)((function(){c(""),u("")}),[e.isOpen]),Object(d.jsxs)(x,{name:"add",title:"Add Photo",buttonText:e.buttonText,isOpen:e.isOpen,onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:o,link:r})},onClose:e.onClose,children:[Object(d.jsx)("input",{className:"form__item form__item_el_name",id:"item-name",type:"text",name:"name",placeholder:"Description",minLength:"2",maxLength:"30",value:o,onChange:function(e){c(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"item-name-error"}),Object(d.jsx)("input",{className:"form__item form__item_el_link",id:"item-url",type:"url",name:"link",placeholder:"Link",value:r,onChange:function(e){u(e.target.value)},required:!0}),Object(d.jsx)("p",{className:"form__error",id:"item-url-error"})]})};var C=function(e){return Object(d.jsx)("div",{className:"popup popup_type_image ".concat(e.card&&"popup_opened"),children:Object(d.jsxs)("div",{className:"popup__container popup__container_type_image",children:[Object(d.jsx)("button",{onClick:e.onClose,className:"popup__close-btn",type:"button","aria-label":"Close popup"}),Object(d.jsxs)("figure",{className:"popup__figure",children:[Object(d.jsx)("img",{className:"popup__image",src:"".concat(e.card.link),alt:"".concat(e.card.name)}),Object(d.jsx)("figcaption",{className:"popup__image-caption",children:e.card.name})]})]})})},y=n.p+"static/media/success-icon.1b6082f8.svg",S=n.p+"static/media/fail-icon.df8eddf6.svg";var U=function(e){return Object(d.jsx)("div",{className:"popup ".concat(e.isOpen&&"popup_opened"),children:Object(d.jsxs)("div",{className:"popup__container popup__container_type_message",children:[Object(d.jsx)("img",{className:"popup__icon",src:e.isSuccess?y:S,alt:e.isSuccess?"Success icon":"Error icon"}),Object(d.jsx)("p",{className:"popup__message",children:e.isSuccess?"Your account has been created successfully!":"Sorry, something went wrong. Please try again."}),Object(d.jsx)("button",{onClick:e.onClose,className:"popup__close-btn",type:"button","aria-label":"Close popup"})]})})},T=n(20),w=n(21),E=new(function(){function e(t){Object(T.a)(this,e),this._baseUrl=t.baseUrl,this._token=t.headers.authorization}return Object(w.a)(e,[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"addNewCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handleResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"setUserInfo",value:function(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then(this._handleResponse)}},{key:"setUserAvatar",value:function(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then(this._handleResponse)}},{key:"changeLikeCardStatus",value:function(e,t){return t?this._deleteLike(e):this._setLike(e)}},{key:"_deleteLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handleResponse)}},{key:"_setLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._token,"Content-Type":"application/json"}}).then(this._handleResponse)}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-24",headers:{authorization:"2a6d7634-25aa-4e7e-bcf3-8309525480f9","Content-Type":"application/json"}}),P="https://auth.nomoreparties.co",L=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},A=n(23),D=n(24),I=["component"],R=function(e){var t=e.component,n=Object(D.a)(e,I);return Object(d.jsx)(u.b,{children:function(){return n.loggedIn?Object(d.jsx)(t,Object(A.a)({},n)):Object(d.jsx)(u.a,{to:"/sign-in"})}})};var z=function(){return Object(d.jsxs)("div",{className:"not-found",children:[Object(d.jsxs)("h3",{className:"not-found__title",children:[Object(d.jsx)("span",{children:"404"})," - Page not found"]}),Object(d.jsx)("p",{className:"not-found__subtitle",children:"Ooooops"})]})};var q=function(){var e=Object(a.useState)({name:"Irina",about:"offline",avatar:""}),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(!1),s=Object(l.a)(c,2),i=s[0],m=s[1],p=Object(a.useState)(""),_=Object(l.a)(p,2),y=_[0],S=_[1],T=Object(a.useState)(!1),w=Object(l.a)(T,2),A=w[0],D=w[1],I=Object(a.useState)(!1),q=Object(l.a)(I,2),J=q[0],F=q[1],M=Object(a.useState)(!1),B=Object(l.a)(M,2),Y=B[0],H=B[1],G=Object(a.useState)(!1),K=Object(l.a)(G,2),Q=K[0],V=K[1],W=Object(a.useState)(!1),X=Object(l.a)(W,2),Z=X[0],$=X[1],ee=Object(a.useState)("Edit"),te=Object(l.a)(ee,2),ne=te[0],ae=te[1],oe=Object(a.useState)("Update"),ce=Object(l.a)(oe,2),se=ce[0],ie=ce[1],re=Object(a.useState)("Post"),le=Object(l.a)(re,2),ue=le[0],me=le[1],de=Object(a.useState)([]),je=Object(l.a)(de,2),be=je[0],pe=je[1],_e=Object(a.useState)(null),he=Object(l.a)(_e,2),fe=he[0],Oe=he[1],ge=Object(a.useState)(!1),xe=Object(l.a)(ge,2),ve=xe[0],Ne=xe[1],ke=Object(u.g)();Object(a.useEffect)((function(){Ce()}),[]),Object(a.useEffect)((function(){Ne(!0),Promise.all([E.getUserInfo(),E.getCards()]).then((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];o(n),pe(a)})).catch((function(e){console.log("Couldnt get data from the server. ".concat(e))})).finally((function(){Ne(!1)}))}),[]);var Ce=function(){if(localStorage.getItem("jwt")){var e=localStorage.getItem("jwt");e&&function(e){return fetch("".concat(P,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){return L(e)}))}(e).then((function(e){e&&(m(!0),S(e.data.email),ke.push("/"))})).catch((function(e){console.log("Error: ".concat(e))}))}};function ye(){D(!1),F(!1),H(!1),Oe(null),V(!1)}return Object(d.jsx)(b.Provider,{value:n,children:Object(d.jsx)("div",{className:"page",children:Object(d.jsxs)("div",{className:"page__container",children:[Object(d.jsx)(j,{loggedIn:i,userEmail:y,onSignOut:function(){m(!1),localStorage.removeItem("jwt"),ke.push("/sign-in")}}),Object(d.jsxs)(u.d,{children:[Object(d.jsx)(R,{exact:!0,path:"/",loggedIn:i,component:h,cards:be,onEditProfile:function(){D(!0)},onAddPlace:function(){F(!0)},onEditAvatar:function(){H(!0)},onCardClick:function(e){Oe(e)},onCardLike:function(e){var t=e.likes.some((function(e){return e._id===n._id}));E.changeLikeCardStatus(e._id,t).then((function(t){pe((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){console.log("".concat(e))}))},onCardDelete:function(e){E.deleteCard(e._id).then((function(){pe(be.filter((function(t){return t!==e})))})).catch((function(e){console.log("".concat(e))}))},isLoading:ve}),Object(d.jsx)(u.b,{path:"/sign-up",children:Object(d.jsx)(O,{onRegistration:function(e){(function(e){var t=e.password,n=e.email;return fetch("".concat(P,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t,email:n})}).then((function(e){return L(e)}))})(e).then((function(){$(!0),V(!0),ke.push("/sign-in")})).catch((function(e){$(!1),V(!0),console.log("Unable to register. ".concat(e))}))}})}),Object(d.jsx)(u.b,{path:"/sign-in",children:Object(d.jsx)(f,{onLogin:function(e){(function(e){var t=e.password,n=e.email;return fetch("".concat(P,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t,email:n})}).then((function(e){return L(e)}))})(e).then((function(t){m(!0),S(e.email),localStorage.setItem("jwt",t.token),ke.push("/")})).catch((function(e){$(!1),V(!0),console.log("Unable to login. ".concat(e))}))}})}),Object(d.jsx)(u.b,{path:"*",children:Object(d.jsx)(z,{})})]}),i&&Object(d.jsx)(g,{}),Object(d.jsx)(v,{buttonText:ne,isOpen:A,onUpdateUser:function(e){ae("Saving..."),E.setUserInfo(e).then((function(e){o(e)})).then((function(){D(!1)})).catch((function(e){console.log("Unable to update user info. ".concat(e))})).finally((function(){ae("Edit")}))},onClose:ye}),Object(d.jsx)(k,{buttonText:ue,isOpen:J,onAddPlace:function(e){me("Uploading..."),E.addNewCard(e).then((function(e){pe([e].concat(Object(r.a)(be)))})).then((function(){F(!1)})).catch((function(e){console.log("Unable to publish a card. ".concat(e))})).finally((function(){me("Post")}))},onClose:ye}),Object(d.jsx)(N,{buttonText:se,isOpen:Y,onUpdateAvatar:function(e){ie("Updading..."),E.setUserAvatar(e).then((function(e){o(e)})).then((function(){H(!1)})).catch((function(e){console.log("Unable to update user avatar. ".concat(e))})).finally((function(){ie("Update")}))},onClose:ye}),Object(d.jsx)(x,{name:"confirm",title:"Please confirm",buttonText:"Yes, delete"}),fe&&Object(d.jsx)(C,{card:fe,onClose:ye}),Object(d.jsx)(U,{isOpen:Q,isSuccess:Z,onClose:ye})]})})})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),o(e),c(e),s(e)}))};s.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(i.a,{basename:"/react-mesto-auth",children:Object(d.jsx)(q,{})})}),document.getElementById("root")),J()}},[[36,1,2]]]);
//# sourceMappingURL=main.1556a5f7.chunk.js.map